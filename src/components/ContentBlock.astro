---
import { Image } from "astro:assets";

export interface Props {
    block: {
        type: string;
        heading?: string;
        subheading?: string;
        content?: string;
        src?: string;
        alt?: string;
        caption?: string;
        items?:
            | string[]
            | Array<{ number: string; title: string; description: string }>;
    };
    projectSlug?: string;
}

const { block, projectSlug } = Astro.props;

let dynamicImage: any = null;
if (block.type === "image" && block.src && projectSlug) {
    try {
        const filename = block.src.split("/").pop();

        if (filename) {
            const images = import.meta.glob(
                "../assets/images/work/**/*.{png,jpg,jpeg,webp}",
                { eager: true }
            );
            const imageKey = Object.keys(images).find(
                (key) =>
                    key.includes(`${projectSlug}/`) && key.includes(filename)
            );

            if (imageKey && images[imageKey]) {
                dynamicImage = (images[imageKey] as any).default || null;
            }
        }
    } catch (error) {
        console.log("Could not load dynamic image:", error);
    }
}
---

{
    block.type === "section" && (
        <section class="content-section section-block">
            {block.heading && (
                <div class="section-heading">{block.heading}</div>
            )}
            {block.subheading && (
                <h2 class="section-subheading">{block.subheading}</h2>
            )}
            {block.content && <p class="section-content">{block.content}</p>}
        </section>
    )
}

{
    block.type === "text" && (
        <section class="content-section text-block">
            {block.heading && <h2>{block.heading}</h2>}
            <p>{block.content}</p>
        </section>
    )
}

{
    block.type === "image" && (
        <section class="content-section image-block">
            <div class="image-container">
                {dynamicImage ? (
                    <Image
                        src={dynamicImage}
                        alt={block.alt || ""}
                        width={800}
                        height={600}
                    />
                ) : (
                    <img src={block.src} alt={block.alt || ""} />
                )}
                {block.caption && <figcaption>{block.caption}</figcaption>}
            </div>
        </section>
    )
}

{
    block.type === "numbered" && (
        <section class="content-section numbered-block">
            {block.heading && (
                <div class="section-heading">{block.heading}</div>
            )}
            <div class="numbered-items">
                {block.items?.map((item) => {
                    if (typeof item === "object" && "number" in item) {
                        return (
                            <div class="numbered-item">
                                <div class="numbered-item-header">
                                    <span class="numbered-item-number">
                                        {item.number}.
                                    </span>
                                    <h3 class="numbered-item-title">
                                        {item.title}
                                    </h3>
                                </div>
                                <p class="numbered-item-description">
                                    {item.description}
                                </p>
                            </div>
                        );
                    }
                    return null;
                })}
            </div>
        </section>
    )
}

{
    block.type === "list" && (
        <section class="content-section list-block">
            {block.heading && <h2>{block.heading}</h2>}
            <ul class="styled-list">
                {block.items?.map((item) => (
                    <li>
                        {typeof item === "string" ? item : item.title || item}
                    </li>
                ))}
            </ul>
        </section>
    )
}

{
    block.type === "header" && (
        <section class="content-section header-block">
            <h1 class="large-header">{block.content}</h1>
        </section>
    )
}

{
    block.type === "quote" && (
        <section class="content-section quote-block">
            <blockquote>
                <p>"{block.content}"</p>
                {block.heading && <cite>— {block.heading}</cite>}
            </blockquote>
        </section>
    )
}

<style>
    .content-section {
        margin-bottom: 5rem;
    }

    /* Section Block Styles */
    .section-block {
        margin-bottom: 6rem;
    }

    .section-heading {
        font-size: var(--text-sm);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--gray-500);
        margin-bottom: 1rem;
    }

    .section-subheading {
        font-size: var(--text-2xl);
        font-weight: 700;
        color: var(--gray-0);
        margin-bottom: 1.25rem;
        line-height: 1.3;
        letter-spacing: -0.01em;
    }

    .section-content {
        font-size: var(--text-base);
        line-height: 1.7;
        color: var(--gray-100);
        max-width: 80ch;
    }

    /* Numbered Block Styles */
    .numbered-block {
        margin-bottom: 6rem;
    }

    .numbered-block .section-heading {
        margin-bottom: 2.5rem;
    }

    .numbered-items {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .numbered-item {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .numbered-item-header {
        display: flex;
        align-items: baseline;
        gap: 1rem;
    }

    .numbered-item-number {
        font-size: var(--text-2xl);
        font-weight: 700;
        color: var(--gray-500);
        min-width: 2.5rem;
        flex-shrink: 0;
    }

    .numbered-item-title {
        font-size: var(--text-lg);
        font-weight: 600;
        color: var(--gray-0);
        margin: 0;
        line-height: 1.3;
    }

    .numbered-item-description {
        font-size: var(--text-sm);
        line-height: 1.6;
        color: var(--gray-200);
        margin-left: 3.5rem;
        max-width: 75ch;
    }

    /* Text Block Styles */
    .text-block h2 {
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 1rem;
        line-height: 1.3;
    }

    .text-block p {
        color: var(--gray-400);
        font-size: 1.125rem;
        line-height: 1.7;
    }

    /* Image Block Styles */
    .image-block {
        margin-bottom: 6rem;
    }

    .image-block .image-container {
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        margin-bottom: 1rem;
    }

    .image-block img {
        width: 100%;
        height: auto;
        display: block;
    }

    .image-block figcaption {
        padding: 0.75rem 0;
        color: var(--gray-500);
        font-size: var(--text-sm);
        text-align: center;
        font-style: italic;
    }

    /* List Block Styles */
    .list-block h2 {
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 1.5rem;
    }

    .styled-list {
        list-style: none;
        padding: 0;
    }

    .styled-list li {
        padding: 0.75rem 0;
        padding-left: 2rem;
        position: relative;
        color: var(--gray-800);
        font-size: 1.125rem;
        line-height: 1.6;
    }

    .styled-list li::before {
        content: "→";
        position: absolute;
        left: 0;
        color: var(--accent);
        font-weight: bold;
    }

    /* Header Block Styles */
    .header-block .large-header {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--gray-900);
        text-align: center;
        margin: 2rem 0;
        line-height: 1.2;
    }

    /* Quote Block Styles */
    .quote-block blockquote {
        border-left: 4px solid var(--accent);
        padding-left: 2rem;
        margin: 2rem 0;
        background: var(--gray-50);
        padding: 2rem;
        border-radius: 0.5rem;
    }

    .quote-block p {
        font-size: 1.25rem;
        font-style: italic;
        color: var(--gray-800);
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .quote-block cite {
        color: var(--gray-700);
        font-size: 1rem;
        font-style: normal;
    }

    @media (max-width: 768px) {
        .content-section {
            margin-bottom: 4rem;
        }

        .section-block {
            margin-bottom: 4rem;
        }

        .section-subheading {
            font-size: var(--text-2xl);
        }

        .section-content {
            font-size: var(--text-base);
            max-width: 100%;
        }

        .numbered-block {
            margin-bottom: 4rem;
        }

        .numbered-block .section-heading {
            margin-bottom: 2rem;
        }

        .numbered-items {
            gap: 2rem;
        }

        .numbered-item-number {
            font-size: var(--text-xl);
            min-width: 2rem;
        }

        .numbered-item-title {
            font-size: var(--text-lg);
        }

        .numbered-item-description {
            font-size: var(--text-sm);
            margin-left: 2.5rem;
            max-width: 100%;
        }

        .image-block {
            margin-bottom: 4rem;
        }

        .text-block h2,
        .list-block h2 {
            font-size: 1.5rem;
        }

        .header-block .large-header {
            font-size: 2rem;
        }

        .text-block p,
        .styled-list li {
            font-size: 1rem;
        }

        .quote-block p {
            font-size: 1.125rem;
        }
    }
</style>
