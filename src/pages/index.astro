---
import Layout from "../layouts/Layout.astro";
import ProjectCard from "../components/ProjectCard.astro";
import projectsData from "../content/projects/projects.json";
import Hero from "../components/Hero.astro";

const allProjects = projectsData.projects;
const featuredProjects = allProjects.filter((project) => project.featured);
---

<Layout>
    <div class="wrapper stack gap-8 lg:gap-20" id="landing">
        <header class="hero">
            <Hero
                title="Hey! I'm Tor"
                tagline="a data scientist driven by deep learning & data-driven decision making"
                align="start"
            >
                <div class="roles">
                    <div class="role-box">Previously Strategy @ Accenture</div>
                    <div class="role-box">
                        Events Director @ CMU Data Science Club
                    </div>
                </div>
            </Hero>
            <div class="hero-viz">
                <svg
                    class="network-viz"
                    viewBox="0 0 400 300"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <defs>
                        <radialGradient id="nodeGradient" cx="50%" cy="50%">
                            <stop
                                offset="0%"
                                style="stop-color:#58a6ff;stop-opacity:0.8"
                            ></stop>
                            <stop
                                offset="100%"
                                style="stop-color:#58a6ff;stop-opacity:0.3"
                            ></stop>
                        </radialGradient>
                        <filter id="glow">
                            <feGaussianBlur
                                stdDeviation="3"
                                result="coloredBlur"></feGaussianBlur>
                            <feMerge>
                                <feMergeNode in="coloredBlur"></feMergeNode>
                                <feMergeNode in="SourceGraphic"></feMergeNode>
                            </feMerge>
                        </filter>
                    </defs>
                    <g class="connections"></g>
                    <g class="best-fit-line"></g>
                    <g class="nodes">
                        <circle
                            class="node"
                            cx="100"
                            cy="80"
                            r="8"
                            fill="url(#nodeGradient)"
                            filter="url(#glow)"></circle>
                        <circle
                            class="node"
                            cx="200"
                            cy="60"
                            r="10"
                            fill="url(#nodeGradient)"
                            filter="url(#glow)"></circle>
                        <circle
                            class="node"
                            cx="300"
                            cy="90"
                            r="7"
                            fill="url(#nodeGradient)"
                            filter="url(#glow)"></circle>
                        <circle
                            class="node"
                            cx="150"
                            cy="150"
                            r="9"
                            fill="url(#nodeGradient)"
                            filter="url(#glow)"></circle>
                        <circle
                            class="node"
                            cx="250"
                            cy="180"
                            r="8"
                            fill="url(#nodeGradient)"
                            filter="url(#glow)"></circle>
                        <circle
                            class="node"
                            cx="80"
                            cy="200"
                            r="7"
                            fill="url(#nodeGradient)"
                            filter="url(#glow)"></circle>
                        <circle
                            class="node"
                            cx="320"
                            cy="220"
                            r="9"
                            fill="url(#nodeGradient)"
                            filter="url(#glow)"></circle>
                        <circle
                            class="node"
                            cx="180"
                            cy="240"
                            r="8"
                            fill="url(#nodeGradient)"
                            filter="url(#glow)"></circle>
                    </g>
                </svg>
            </div>
        </header>

        <!-- Selected Projects Section -->
        {
            featuredProjects.length > 0 && (
                <section class="selected-projects">
                    <div class="section-title">
                        <h2>Select works</h2>
                    </div>
                    <div class="projects-grid">
                        {featuredProjects.map((project) => (
                            <ProjectCard
                                slug={project.slug}
                                title={project.title}
                                description={project.description}
                                tags={project.tags}
                                image={project.image}
                                bgColor={project.bgColor}
                            />
                        ))}
                    </div>
                </section>
            )
        }
    </div>
    <body> </body>
</Layout>

<script is:inline>
    document.addEventListener("DOMContentLoaded", function () {
        const svg = document.querySelector(".network-viz");
        const connectionsGroup = document.querySelector(".connections");
        const nodes = document.querySelectorAll(".node");

        if (!svg || !connectionsGroup || nodes.length === 0) return;

        const nodePositions = Array.from(nodes).map(function (node) {
            const cxAttr = node.getAttribute("cx");
            const cyAttr = node.getAttribute("cy");
            const cx = cxAttr ? parseFloat(cxAttr) : 0;
            const cy = cyAttr ? parseFloat(cyAttr) : 0;
            return { x: cx, y: cy };
        });

        const connections = [];
        for (let i = 0; i < nodePositions.length; i++) {
            for (let j = i + 1; j < nodePositions.length; j++) {
                const dx = nodePositions[i].x - nodePositions[j].x;
                const dy = nodePositions[i].y - nodePositions[j].y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < 180) {
                    connections.push([i, j, distance]);
                }
            }
        }

        connections.sort(function (a, b) {
            return a[2] - b[2];
        });

        connections.forEach(function (conn, index) {
            const i = conn[0];
            const j = conn[1];
            const distance = conn[2];
            const line = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "line"
            );
            line.setAttribute("x1", nodePositions[i].x.toString());
            line.setAttribute("y1", nodePositions[i].y.toString());
            line.setAttribute("x2", nodePositions[j].x.toString());
            line.setAttribute("y2", nodePositions[j].y.toString());
            line.style.animationDelay = 0.5 + index * 0.1 + "s";
            line.style.strokeDasharray = distance.toString();
            connectionsGroup.appendChild(line);
        });

        const bestFitGroup = document.querySelector(".best-fit-line");
        if (bestFitGroup && nodePositions.length > 1) {
            const meanX =
                nodePositions.reduce(function (sum, pos) {
                    return sum + pos.x;
                }, 0) / nodePositions.length;
            const meanY =
                nodePositions.reduce(function (sum, pos) {
                    return sum + pos.y;
                }, 0) / nodePositions.length;

            let numerator = 0;
            let denominator = 0;
            for (let i = 0; i < nodePositions.length; i++) {
                numerator +=
                    (nodePositions[i].x - meanX) * (nodePositions[i].y - meanY);
                denominator +=
                    (nodePositions[i].x - meanX) * (nodePositions[i].x - meanX);
            }
            const slope = denominator !== 0 ? numerator / denominator : 0;
            const intercept = meanY - slope * meanX;

            const minX = 0;
            const maxX = 400;
            let y1 = slope * minX + intercept;
            let y2 = slope * maxX + intercept;

            y1 = Math.max(0, Math.min(300, y1));
            y2 = Math.max(0, Math.min(300, y2));

            const bestFitLine = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "line"
            );
            bestFitLine.setAttribute("x1", minX.toString());
            bestFitLine.setAttribute("y1", y1.toString());
            bestFitLine.setAttribute("x2", maxX.toString());
            bestFitLine.setAttribute("y2", y2.toString());
            bestFitLine.setAttribute("stroke", "#0d1117");
            bestFitLine.setAttribute("stroke-width", "2.5");
            bestFitLine.setAttribute("fill", "none");
            const lineLength = Math.sqrt(
                Math.pow(maxX - minX, 2) + Math.pow(y2 - y1, 2)
            );
            bestFitLine.style.strokeDasharray = lineLength.toString();
            bestFitLine.style.strokeDashoffset = lineLength.toString();
            bestFitLine.style.opacity = "0";
            bestFitGroup.appendChild(bestFitLine);

            setTimeout(function () {
                bestFitLine.style.transition =
                    "stroke-dashoffset 2.5s ease-out, opacity 2.5s ease-out";
                bestFitLine.style.strokeDashoffset = "0";
                bestFitLine.style.opacity = "0.7";
            }, 1500);
        }

        nodes.forEach(function (node, index) {
            node.addEventListener("mouseenter", function () {
                const connectedLines = Array.from(
                    connectionsGroup.children
                ).filter(function (line, lineIndex) {
                    const conn = connections[lineIndex];
                    const i = conn[0];
                    const j = conn[1];
                    return i === index || j === index;
                });
                connectedLines.forEach(function (line) {
                    line.style.opacity = "0.6";
                    line.style.strokeWidth = "2";
                });
            });

            node.addEventListener("mouseleave", function () {
                Array.from(connectionsGroup.children).forEach(function (line) {
                    line.style.opacity = "0.2";
                    line.style.strokeWidth = "1.5";
                });
            });
        });
    });
</script>

<style>
    #landing {
        padding-top: 4rem;
        padding-bottom: 4rem;
    }

    .hero {
        display: flex;
        flex-direction: column;
        align-items: start;
        gap: 2rem;
        margin: 2rem;
        margin-bottom: 3rem;
        max-width: 100%;
    }

    .hero-viz {
        display: none;
        flex: 1;
        max-width: 400px;
        opacity: 0.6;
    }

    .network-viz {
        width: 100%;
        height: auto;
    }

    .node {
        opacity: 0;
        transform: scale(0);
        animation: nodePulse 2s ease-out infinite;
        cursor: pointer;
    }

    .node:nth-child(1) {
        animation-delay: 0s;
    }
    .node:nth-child(2) {
        animation-delay: 0.2s;
    }
    .node:nth-child(3) {
        animation-delay: 0.4s;
    }
    .node:nth-child(4) {
        animation-delay: 0.6s;
    }
    .node:nth-child(5) {
        animation-delay: 0.8s;
    }
    .node:nth-child(6) {
        animation-delay: 1s;
    }
    .node:nth-child(7) {
        animation-delay: 1.2s;
    }
    .node:nth-child(8) {
        animation-delay: 1.4s;
    }

    .connections line {
        stroke: #58a6ff;
        stroke-width: 1.5;
        opacity: 0.2;
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
        animation: drawConnection 2s ease-out forwards;
        transition:
            opacity 0.3s ease,
            stroke-width 0.3s ease;
    }

    .best-fit-line line {
        stroke: #0d1117;
        stroke-width: 2.5;
    }

    @keyframes nodePulse {
        0% {
            opacity: 0;
            transform: scale(0);
        }
        50% {
            opacity: 1;
            transform: scale(1.1);
        }
        100% {
            opacity: 0.8;
            transform: scale(1);
        }
    }

    @keyframes drawConnection {
        to {
            stroke-dashoffset: 0;
        }
    }

    @keyframes drawBestFit {
        to {
            stroke-dashoffset: 0;
            opacity: 0.7;
        }
    }

    .roles {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-top: 1.5rem;
    }

    .role-box {
        font-size: var(--text-md);
        color: var(--white);
        padding: 0.5rem 1rem;
        background-color: var(--black);
        display: inline-block;
        white-space: nowrap;
        line-height: 1.35;
    }

    .selected-projects {
        margin-top: 2rem;
        margin-bottom: 4rem;
    }

    .section-title {
        padding: 2em 2em 2em 2rem;
    }

    .section-title h2 {
        font-size: var(--text-3xl);
        color: var(--gray-0);
        margin: 0;
    }

    .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
        align-items: stretch;
        padding: 0 2em;
    }

    @media (min-width: 50em) {
        #landing {
            padding-top: 6rem;
        }

        .hero {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 4rem;
            align-items: center;
            padding-inline: 4rem;
            margin-bottom: 3rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-viz {
            display: block;
        }

        .roles {
            margin-top: 1rem;
            display: flex;
            flex-direction: row;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .section-title {
            padding-left: 4rem;
        }

        .projects-grid {
            padding: 0 4rem;
        }
    }

    @media (max-width: 768px) {
        .section-title h2 {
            font-size: var(--text-2xl);
        }

        .projects-grid {
            grid-template-columns: 1fr;
            padding: 0 1.5em;
        }
    }
</style>
